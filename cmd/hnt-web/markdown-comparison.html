<!DOCTYPE html>
<html>
<head>
    <title>Markdown Parser Comparison</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .parser { border: 1px solid #ccc; padding: 15px; border-radius: 5px; }
        .parser h3 { margin-top: 0; }
        .test { margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .input { font-family: monospace; background: #e0e0e0; padding: 5px; margin: 5px 0; }
        .output { background: #fff; padding: 5px; margin: 5px 0; border: 1px solid #ddd; }
        .rendered { padding: 5px; margin: 5px 0; border: 1px solid #888; background: #fafafa; }
        .pass { background: #d0ffd0; }
        .fail { background: #ffd0d0; }
        .improved { background: #d0d0ff; }
        code { background: #f0f0f0; padding: 2px 4px; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Markdown Parser Comparison</h1>
    <p>Comparing the current regex-based parser with an improved state machine parser.</p>
    
    <div id="comparisons"></div>

    <script>
        // Current implementation
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function renderMarkdownCurrent(text) {
            let html = escapeHtml(text);
            html = html.replace(/```([\s\S]*?)```/g, "<pre><code>$1</code></pre>");
            html = html.replace(/`([^`]+)`/g, "<code>$1</code>");
            html = html.replace(/\*\*([^\*]+)\*\*/g, "<strong>$1</strong>");
            html = html.replace(/__([^_]+)__/g, "<strong>$1</strong>");
            html = html.replace(/\b\*([^\*]+)\*\b/g, "<em>$1</em>");
            html = html.replace(/\b_([^_]+)_\b/g, "<em>$1</em>");
            return html;
        }

        // Load improved implementation
    </script>
    <script src="markdown-parser-simple.js?v=5"></script>
    <script>
        // Test cases
        const testCases = [
            {
                category: "Basic Formatting",
                tests: [
                    { input: "**bold text**", expected: "<strong>bold text</strong>" },
                    { input: "__bold text__", expected: "<strong>bold text</strong>" },
                    { input: "*italic text*", expected: "<em>italic text</em>" },
                    { input: "_italic text_", expected: "<em>italic text</em>" },
                ]
            },
            {
                category: "Complex Cases (Current Parser Fails)",
                tests: [
                    { input: "**bold *italic* text**", expected: "<strong>bold <em>italic</em> text</strong>" },
                    { input: "*italic **bold** text*", expected: "<em>italic <strong>bold</strong> text</em>" },
                    { input: "**bold _italic_ text**", expected: "<strong>bold <em>italic</em> text</strong>" },
                    { input: "_italic __bold__ text_", expected: "<em>italic <strong>bold</strong> text</em>" },
                    { input: "***bold and italic***", expected: "<strong><em>bold and italic</em></strong>" },
                    { input: "**bold with * asterisk**", expected: "<strong>bold with * asterisk</strong>" },
                ]
            },
            {
                category: "Edge Cases",
                tests: [
                    { input: "**bold** and **more bold**", expected: "<strong>bold</strong> and <strong>more bold</strong>" },
                    { input: "un*believ*able", expected: "un<em>believ</em>able", note: "Italic within word" },
                    { input: "**unclosed bold", expected: "<strong>unclosed bold</strong>", note: "Should close gracefully" },
                    { input: "*unclosed italic", expected: "<em>unclosed italic</em>", note: "Should close gracefully" },
                    { input: "**bold *italic **nested** italic* bold**", expected: "<strong>bold <em>italic <strong>nested</strong> italic</em> bold</strong>" },
                ]
            },
            {
                category: "Mixed Content",
                tests: [
                    { input: "Text with `code` and **bold**", expected: "Text with <code>code</code> and <strong>bold</strong>" },
                    { input: "**bold with `code` inside**", expected: "<strong>bold with <code>code</code> inside</strong>" },
                ]
            }
        ];

        // Run comparisons
        const container = document.getElementById('comparisons');
        
        testCases.forEach(category => {
            const categoryDiv = document.createElement('div');
            categoryDiv.innerHTML = `<h2>${category.category}</h2>`;
            
            category.tests.forEach(test => {
                const compDiv = document.createElement('div');
                compDiv.className = 'comparison';
                
                // Current parser
                const currentResult = renderMarkdownCurrent(test.input);
                const currentPassed = currentResult === test.expected;
                
                // Improved parser
                const improvedResult = renderMarkdownSimple(test.input);
                const improvedPassed = improvedResult === test.expected;
                
                compDiv.innerHTML = `
                    <div class="parser ${currentPassed ? 'pass' : 'fail'}">
                        <h3>Current Parser (Regex)</h3>
                        <div class="test">
                            <div class="input">Input: <code>${escapeHtml(test.input)}</code></div>
                            ${test.note ? `<div><em>${test.note}</em></div>` : ''}
                            <div class="output">Output: <code>${escapeHtml(currentResult)}</code></div>
                            <div class="rendered">Rendered: ${currentResult}</div>
                            <div><strong>Status: ${currentPassed ? '✓ PASS' : '✗ FAIL'}</strong></div>
                        </div>
                    </div>
                    <div class="parser ${improvedPassed ? 'pass improved' : 'fail'}">
                        <h3>Improved Parser (Simple)</h3>
                        <div class="test">
                            <div class="input">Input: <code>${escapeHtml(test.input)}</code></div>
                            ${test.note ? `<div><em>${test.note}</em></div>` : ''}
                            <div class="output">Output: <code>${escapeHtml(improvedResult)}</code></div>
                            <div class="rendered">Rendered: ${improvedResult}</div>
                            <div><strong>Status: ${improvedPassed ? '✓ PASS' : '✗ FAIL'}</strong></div>
                        </div>
                    </div>
                `;
                
                categoryDiv.appendChild(compDiv);
            });
            
            container.appendChild(categoryDiv);
        });
        
        // Summary statistics
        let currentPasses = 0, improvedPasses = 0, totalTests = 0;
        testCases.forEach(cat => {
            cat.tests.forEach(test => {
                totalTests++;
                if (renderMarkdownCurrent(test.input) === test.expected) currentPasses++;
                if (renderMarkdownSimple(test.input) === test.expected) improvedPasses++;
            });
        });
        
        const summary = document.createElement('div');
        summary.innerHTML = `
            <h2>Summary</h2>
            <p><strong>Current Parser:</strong> ${currentPasses}/${totalTests} tests passed (${Math.round(currentPasses/totalTests*100)}%)</p>
            <p><strong>Improved Parser:</strong> ${improvedPasses}/${totalTests} tests passed (${Math.round(improvedPasses/totalTests*100)}%)</p>
        `;
        document.body.insertBefore(summary, container);
    </script>
</body>
</html>